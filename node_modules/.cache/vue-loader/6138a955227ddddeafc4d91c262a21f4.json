{"remainingRequest":"/home/joel/Projetos/sigadm-team/sigadm-web/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/joel/Projetos/sigadm-team/sigadm-web/src/pages/Modulos/Patrimonio/Instrumento/Devolucao/DevolucaoModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/joel/Projetos/sigadm-team/sigadm-web/src/pages/Modulos/Patrimonio/Instrumento/Devolucao/DevolucaoModal.vue","mtime":1577190729000},{"path":"/home/joel/Projetos/sigadm-team/sigadm-web/node_modules/cache-loader/dist/cjs.js","mtime":1569691702000},{"path":"/home/joel/Projetos/sigadm-team/sigadm-web/node_modules/babel-loader/lib/index.js","mtime":1569691629000},{"path":"/home/joel/Projetos/sigadm-team/sigadm-web/node_modules/cache-loader/dist/cjs.js","mtime":1569691702000},{"path":"/home/joel/Projetos/sigadm-team/sigadm-web/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1569691710000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport swal from \"sweetalert2\";\n\nexport default {\n  data() {\n    return {\n      dialog: false,\n      dialog_devolucao: false,\n      data_devolucao: new Date().toISOString().substr(0, 10),\n      modal: false,\n      emprestimos: [],\n      id_emprestimo: 0,\n      observacao: \"\"\n    };\n  },\n  computed: {\n    computedDateFormatted() {\n      return this.formatDate(this.data_devolucao);\n    }\n  },\n  watch: {\n    date(val) {\n      this.dateFormatted = this.formatDate(this.data_devolucao);\n    }\n  },\n  props: [\"numero_do_tombamento_devolucao\", \"numero_do_instrumento_devolucao\"],\n  methods: {    \n    CadastrarDevolucao() {\n      ////console.log(\"cadastrar devolução\");\n      let autorizacaoAux = sessionStorage.getItem(\"usuario\");\n      var id_emprestimo_buscado;\n      if (!autorizacaoAux) {\n        swal.fire(\n          \"Sua autorização expirou!\",\n          \"Entre com suas credencias novamente.\",\n          \"warning\"\n        );\n        this.$router.push(\"/\");\n      }\n      if (autorizacaoAux) {\n        //console.log(\"cadastrar devolução buscando\");\n        this.autorizacao = JSON.parse(autorizacaoAux);\n        ////console.log(\"entrou no cadastro de devolucao\");\n        this.$http\n          .get(\n            this.$url +\n              \"EmprestimoInstrumento/v1/buscar-emprestimo?tombamento=\" +\n              this.numero_do_tombamento_devolucao,\n            {\n              headers: {\n                authorization: \"Bearer \" + this.autorizacao.accessToken\n              }\n            }\n          )\n          .then(response => {\n            if (response.status == 200) {\n              this.emprestimos = response.data;\n              this.Loading(\"Realizando devolução...\",\"hourglass-half\")              \n              ////console.log(this.emprestimos);\n              this.emprestimos.forEach(element => {\n                ////console.log(\"status: \", element.id);\n                id_emprestimo_buscado = element.id;\n                ////console.log(id_emprestimo_buscado);\n                if (element.status == 2) //console.log(\"cadastrar devolução\");                \n                this.$http\n                  .post(\n                    this.$url + \"DevolucaoInstrumento/v1\",\n                    {\n                      id: 0,\n                      idInstrumento: this.numero_do_instrumento_devolucao,\n                      idEmprestimo: id_emprestimo_buscado,\n                      tombamento: this.numero_do_tombamento_devolucao,\n                      status: \"1\",\n                      devolucaoDate: this.data_devolucao,\n                      observacao: this.observacao,\n                      launchDate: new Date().toISOString().substr(0, 19)\n                    },\n                    {\n                      headers: {\n                        authorization: \"Bearer \" + this.autorizacao.accessToken\n                      }\n                    }\n                  )\n                  .then(response => {\n                    if (response.status == 200) {\n                      // //console.log(\"data value emprestimo\", response.data);                     \n                      this.$emit(\"devolucao_atualizar\");\n                    }\n                  })\n                  .catch(e => {\n                    swal.fire(\n                      \"Sua autorização expirou!\",\n                      \"Entre com suas credencias novamente.\",\n                      \"warning\"\n                    );\n                    this.$router.push(\"/\");\n                    //console.error(e);\n                    //console.data(e.data);\n                    //console.log(\"status\", e.data.status);\n                  });\n              });\n            }\n          })\n          .catch(e => {\n            swal.fire(\n              \"Sua autorização expirou!\",\n              \"Entre com suas credencias novamente.\",\n              \"warning\"\n            );\n            this.$router.push(\"/\");\n            //console.log(\"Erro no emprestimo\");\n            //console.error(e);\n            //console.data(e.data);\n          });\n      }\n    },\n    Loading(title,icon) {\n      swal.fire({\n        title: title,\n        html:\n          \"Por favor só um momento... \" +\n          '<i class=\"fas fa-'+icon+'></i>',\n        timer: 3000,\n        onOpen: () => {\n          swal.enableLoading();\n        }\n      });\n    },\n    Salvo(title,msg,type) {\n      swal.fire(title, msg,type);\n    },\n    formatDate(date) {\n      if (!date) return null;\n\n      const [year, month, day] = date.split(\"-\");\n      return `${day}/${month}/${year}`;\n    }\n  }\n};\n",{"version":3,"sources":["DevolucaoModal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"DevolucaoModal.vue","sourceRoot":"src/pages/Modulos/Patrimonio/Instrumento/Devolucao","sourcesContent":["<template>\n  <v-layout row justify-left class=\"\">\n    <v-dialog v-model=\"dialog\" persistent max-width=\"600px\">\n      <v-btn slot=\"activator\" flat color=\"red\" class=\"align-left\">\n        <small>DEVOLVER</small>\n      </v-btn>\n      <v-card>\n        <v-flex xs12 sm12>\n          <div class=\"pt-3\">\n            <v-btn\n              right\n              class=\"white--text\"\n              small\n              fab\n              round\n              outline\n              color=\"red darken-1\"\n              absolute\n              v-on:click=\"dialog = false\"\n            >\n              <v-icon>close</v-icon>\n            </v-btn>\n          </div>\n        </v-flex>\n        <v-card-title>\n          <v-flex xs12 sm12 md12 lg12 align-center>\n            <span class=\"headline teal--text text--darken-3\">Devolução</span>\n          </v-flex>\n        </v-card-title>\n        <v-card-text>\n          <v-container grid-list-md>\n            <v-layout wrap>\n              <v-flex xs12 sm12 md12>\n                <v-dialog\n                  ref=\"dialog_devolucao\"\n                  v-model=\"modal\"\n                  :return-value.sync=\"data_devolucao\"\n                  persistent\n                  lazy\n                  full-width\n                  width=\"290px\"\n                >\n                  <v-text-field\n                    slot=\"activator\"\n                    v-model=\"computedDateFormatted\"\n                    label=\"Data da Devolução *\"\n                    append-icon=\"event\"\n                    readonly\n                    hint\n                    persistent-hint\n                    outline\n                  ></v-text-field>\n                  <v-date-picker v-model=\"data_devolucao\" scrollable locale=\"pt-BR\">\n                    <v-spacer></v-spacer>\n                    <v-btn flat color=\"primary\" @click=\"modal = false\">Cancelar</v-btn>\n                    <v-btn\n                      flat\n                      color=\"primary\"\n                      @click=\"$refs.dialog_devolucao.save(data_devolucao)\"\n                    >OK</v-btn>\n                  </v-date-picker>\n                </v-dialog>\n              </v-flex>\n              <v-flex xs12 sm12 md12>\n                <v-text-field\n                  v-model=\"observacao\"\n                  outline\n                  color=\"teal darken-3\"\n                  append-icon=\"fas fa-eye\"\n                  label=\"Observação\"\n                  required\n                ></v-text-field>\n              </v-flex>\n              <v-flex xs12 sm12 md12 lg12 align-center>\n                <small>*campos com asterisco (*) são obrigatórios.</small>\n              </v-flex>\n            </v-layout>\n          </v-container>\n        </v-card-text>\n        <v-card-actions>\n          <v-spacer></v-spacer>\n          <v-flex xs12 sm12 md12 lg12 align-center>\n            <v-btn\n              color=\"teal darken-2\"\n              round\n              center\n              outline\n              v-on:click=\"CadastrarDevolucao()\"\n              @click=\"dialog = false\"\n            >DEVOLVER</v-btn>\n          </v-flex>\n        </v-card-actions>\n      </v-card>\n    </v-dialog>\n  </v-layout>\n</template>\n<script>\nimport swal from \"sweetalert2\";\n\nexport default {\n  data() {\n    return {\n      dialog: false,\n      dialog_devolucao: false,\n      data_devolucao: new Date().toISOString().substr(0, 10),\n      modal: false,\n      emprestimos: [],\n      id_emprestimo: 0,\n      observacao: \"\"\n    };\n  },\n  computed: {\n    computedDateFormatted() {\n      return this.formatDate(this.data_devolucao);\n    }\n  },\n  watch: {\n    date(val) {\n      this.dateFormatted = this.formatDate(this.data_devolucao);\n    }\n  },\n  props: [\"numero_do_tombamento_devolucao\", \"numero_do_instrumento_devolucao\"],\n  methods: {    \n    CadastrarDevolucao() {\n      ////console.log(\"cadastrar devolução\");\n      let autorizacaoAux = sessionStorage.getItem(\"usuario\");\n      var id_emprestimo_buscado;\n      if (!autorizacaoAux) {\n        swal.fire(\n          \"Sua autorização expirou!\",\n          \"Entre com suas credencias novamente.\",\n          \"warning\"\n        );\n        this.$router.push(\"/\");\n      }\n      if (autorizacaoAux) {\n        //console.log(\"cadastrar devolução buscando\");\n        this.autorizacao = JSON.parse(autorizacaoAux);\n        ////console.log(\"entrou no cadastro de devolucao\");\n        this.$http\n          .get(\n            this.$url +\n              \"EmprestimoInstrumento/v1/buscar-emprestimo?tombamento=\" +\n              this.numero_do_tombamento_devolucao,\n            {\n              headers: {\n                authorization: \"Bearer \" + this.autorizacao.accessToken\n              }\n            }\n          )\n          .then(response => {\n            if (response.status == 200) {\n              this.emprestimos = response.data;\n              this.Loading(\"Realizando devolução...\",\"hourglass-half\")              \n              ////console.log(this.emprestimos);\n              this.emprestimos.forEach(element => {\n                ////console.log(\"status: \", element.id);\n                id_emprestimo_buscado = element.id;\n                ////console.log(id_emprestimo_buscado);\n                if (element.status == 2) //console.log(\"cadastrar devolução\");                \n                this.$http\n                  .post(\n                    this.$url + \"DevolucaoInstrumento/v1\",\n                    {\n                      id: 0,\n                      idInstrumento: this.numero_do_instrumento_devolucao,\n                      idEmprestimo: id_emprestimo_buscado,\n                      tombamento: this.numero_do_tombamento_devolucao,\n                      status: \"1\",\n                      devolucaoDate: this.data_devolucao,\n                      observacao: this.observacao,\n                      launchDate: new Date().toISOString().substr(0, 19)\n                    },\n                    {\n                      headers: {\n                        authorization: \"Bearer \" + this.autorizacao.accessToken\n                      }\n                    }\n                  )\n                  .then(response => {\n                    if (response.status == 200) {\n                      // //console.log(\"data value emprestimo\", response.data);                     \n                      this.$emit(\"devolucao_atualizar\");\n                    }\n                  })\n                  .catch(e => {\n                    swal.fire(\n                      \"Sua autorização expirou!\",\n                      \"Entre com suas credencias novamente.\",\n                      \"warning\"\n                    );\n                    this.$router.push(\"/\");\n                    //console.error(e);\n                    //console.data(e.data);\n                    //console.log(\"status\", e.data.status);\n                  });\n              });\n            }\n          })\n          .catch(e => {\n            swal.fire(\n              \"Sua autorização expirou!\",\n              \"Entre com suas credencias novamente.\",\n              \"warning\"\n            );\n            this.$router.push(\"/\");\n            //console.log(\"Erro no emprestimo\");\n            //console.error(e);\n            //console.data(e.data);\n          });\n      }\n    },\n    Loading(title,icon) {\n      swal.fire({\n        title: title,\n        html:\n          \"Por favor só um momento... \" +\n          '<i class=\"fas fa-'+icon+'></i>',\n        timer: 3000,\n        onOpen: () => {\n          swal.enableLoading();\n        }\n      });\n    },\n    Salvo(title,msg,type) {\n      swal.fire(title, msg,type);\n    },\n    formatDate(date) {\n      if (!date) return null;\n\n      const [year, month, day] = date.split(\"-\");\n      return `${day}/${month}/${year}`;\n    }\n  }\n};\n</script>\n<style>\n.mesmo-tamanho {\n  width: 100%;\n  white-space: normal;\n}\n</style>\n"]}]}